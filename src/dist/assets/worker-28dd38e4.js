(function(){"use strict";const s={TOMATO:1,REST:2},e={ready_rest:{type:0,message:"开始休息"},end:{type:1,message:"结束"},ready_tomato:{type:2,message:"开始专注"}},m=0,T=1,i=2;let a=!0,n;onmessage=o=>{let t=o.data;n=new u(parseInt(t.tomatoes),parseInt(t.rests),parseInt(t.cycles)),n.start()};class u{constructor(t,r,c){this.timeId=void 0,this.status=s.TOMATO,this.tomatoes=t,this.rests=r,this.cycles=c,this.target_time=void 0}main_process(){let t=this.getRemainTime();if(t<=1e4&&a&&(self.postMessage({isPlayed:!0}),a=!1),t<=0){if(this.stop(),this.status==s.TOMATO&&this.cycles--,this.notification(),this.status==s.REST&&this.cycles==0){self.postMessage({remain_seconds:0,status:T});return}this.status=this.status==s.TOMATO?s.REST:s.TOMATO,this.start()}else this.sendTime(t/1e3),this.timeId=setTimeout(()=>{this.main_process()},500)}start(){let t=new Date;this.status==s.TOMATO?t.setMinutes(t.getMinutes()+this.tomatoes):this.status==s.REST&&t.setMinutes(t.getMinutes()+this.rests),this.target_time=t,setTimeout(()=>{this.main_process()},10)}getRemainTime(){let t=new Date;return this.target_time-t}stop(){clearTimeout(this.timeId),a=!0,postMessage({isPlayed:!1})}notification(){this.status==s.TOMATO?this.rests>0&&self.postMessage({notification:e.ready_rest,status:i}):this.cycles==0?self.postMessage({notification:e.end,status:i}):self.postMessage({notification:e.ready_tomato,status:i})}sendTime(t){postMessage({remain_seconds:t,status:m,running_status:this.status})}}})();
